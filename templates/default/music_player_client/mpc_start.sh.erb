#!/usr/bin/env bash
#
#
#

(while sleep 1;
  do mplayer -cache <%= @cache_size %> \
    http://localhost:<%= @local[:port_streaming] %>/ 2>&1>/dev/null
done) &

pids="$!"

ssh -CN \
  -L<%= @local[:port_streaming] %>:10.30.1.134:<%= @server[:port_streaming] %> \
  -L<%= @local[:port] %>:10.30.1.134:<%= @server[:port] %> \
  <%= @gateway[:host] %> 2>&1>/dev/null &

pids="$pids $!"

trap 'kill $pids; exit' SIGHUP SIGINT SIGQUIT SIGTERM

wait
